<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>大樂透開獎程式</title>
  <style>
    body {
      font-family: "微軟正黑體", sans-serif;
      text-align: center;
      background-color: #f0f0f0;
      padding: 50px 20px;
    }

    h1 {
      color: #2c3e50;
    }

    #lottoNumbers {
      margin-top: 30px;
    }

    .number {
      display: inline-block;
      width: 60px;
      height: 60px;
      line-height: 60px;
      margin: 10px;
      border-radius: 50%;
      background-color: #3498db;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    .special {
      background-color: #e74c3c;
    }

    button {
      margin-top: 20px;
      padding: 12px 30px;
      font-size: 20px;
      border: none;
      border-radius: 5px;
      background-color: #2ecc71;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: #27ae60;
    }

    #history {
      margin-top: 40px;
      text-align: center;
    }

    .record {
      margin: 10px 0;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <h1>大樂透開獎模擬器</h1>

  <div id="lottoNumbers"></div>

  <button onclick="drawLotto()">開獎！</button>
<div style="margin-top: 20px;">
  <button onclick="copyWinningNumbers()">套用開獎號碼到對獎欄位</button>
</div>


  
<div id="history" style="margin-top: 40px;">
  <h2>最新一期開獎記錄</h2>
  <table style="margin: 0 auto; border-collapse: collapse;">
    <tr>
      <th style="padding:4px;">期別</th>
      <th style="padding:4px;">開獎日期</th>
      <th style="padding:4px;">號碼</th>
      <th style="padding:4px;">特別號</th>
    </tr>
    <tr>
      <td style="padding:4px;">第114000043期</td>
      <td style="padding:4px;">2025/04/11</td>
      <td style="padding:4px;">06, 10, 11, 17, 23, 32</td>
      <td style="padding:4px; color: red; font-weight:bold;">27</td>
    </tr>
  </table>
</div>

<script>
    function drawLotto() {
      const numbers = new Set();
      while (numbers.size < 6) {
        numbers.add(Math.floor(Math.random() * 49) + 1);
      }

      const sortedNumbers = Array.from(numbers).sort((a, b) => a - b);
      const specialNumber = Math.floor(Math.random() * 49) + 1;

      const container = document.getElementById("lottoNumbers");
      container.innerHTML = '';

      sortedNumbers.forEach(num => {
        const ball = document.createElement("div");
        ball.className = "number";
        ball.textContent = num;
        container.appendChild(ball);
      });

      const special = document.createElement("div");
      special.className = "number special";
      special.textContent = specialNumber;
      container.appendChild(special);
    }
  </script>


  <div style="margin-top: 50px;">
    <h2>對獎區</h2>
    <p>請輸入你買的 6 個號碼（1~49，不可重複）：</p>
    <input type="number" id="num1" min="1" max="49" style="width:50px; font-size:16px; margin:2px;" /><input type="number" id="num2" min="1" max="49" style="width:50px; font-size:16px; margin:2px;" /><input type="number" id="num3" min="1" max="49" style="width:50px; font-size:16px; margin:2px;" /><input type="number" id="num4" min="1" max="49" style="width:50px; font-size:16px; margin:2px;" /><input type="number" id="num5" min="1" max="49" style="width:50px; font-size:16px; margin:2px;" /><input type="number" id="num6" min="1" max="49" style="width:50px; font-size:16px; margin:2px;" />
    <button onclick="checkWinning()">對獎</button>
    <div id="result" style="margin-top: 20px; font-size:18px; font-weight:bold;"></div>
    
    
  </div>

  <script>
    function checkWinning() {
      const userNums = [];
for (let i = 1; i <= 6; i++) {
  const val = parseInt(document.getElementById("num" + i).value);
  if (!isNaN(val)) userNums.push(val);
}
      const drawnNums = Array.from(document.querySelectorAll(".number:not(.special)")).map(el => parseInt(el.textContent));
      const specialNum = parseInt(document.querySelector(".number.special").textContent);
      
      if (userNums.length !== 6 || new Set(userNums).size !== 6 || userNums.some(n => n < 1 || n > 49)) {
        document.getElementById("result").textContent = "請輸入正確的 6 個號碼（1~49 且不可重複）";
        return;
      }

      let match = userNums.filter(n => drawnNums.includes(n)).length;
      let matchSpecial = userNums.includes(specialNum);
      let message = "";

      if (match === 6) {
        message = "恭喜你中頭獎！";
      } else if (match === 5 && matchSpecial) {
        message = "中貳獎（5碼+特別號）！";
      } else if (match === 5) {
        message = "中參獎（5碼）";
      } else if (match === 4 && matchSpecial) {
        message = "中肆獎（4碼+特別號）";
      } else if (match === 4) {
        message = "中伍獎（4碼）";
      } else if (match === 3 && matchSpecial) {
        message = "中陸獎（3碼+特別號）";
      } else if (match === 3) {
        message = "中柒獎（3碼）";
      } else if (match === 2 && matchSpecial) {
        message = "中普獎（2碼+特別號）";
      } else {
        message = "很可惜沒中獎～再接再厲！";
      }

      document.getElementById("result").textContent = message;


for (let i = 1; i <= 6; i++) {
  const input = document.getElementById("num" + i);
  input.addEventListener("input", function () {
    if (this.value.length === 2 && i < 6) {
      document.getElementById("num" + (i + 1)).focus();
    }
  });
}

    }

    async function loadHistory() {
      try {
        const res = await fetch('https://superiorapis.cteam.com.tw/api/lottery/649/history?limit=5');
        const data = await res.json();
        const container = document.getElementById('historyList');
        container.innerHTML = '';

        
    
    let table = '<table style="margin: 0 auto; border-collapse: collapse;">';
    table += '<tr><th style="padding:4px;">期別</th><th style="padding:4px;">號碼</th><th style="padding:4px;">特別號</th></tr>';
    data.forEach(draw => {
      const numbers = draw.numbers.map(n => String(n).padStart(2, '0')).join(', ');
      table += `<tr>
                  <td style="padding:4px;">${draw.term}</td>
                  <td style="padding:4px;">${numbers}</td>
                  <td style="padding:4px; color: red; font-weight:bold;">${draw.special}</td>
                </tr>`;
    });
    table += '</table>';
    container.innerHTML = table;
    
    
      } catch (e) {
        document.getElementById('historyList').textContent = '無法載入歷史紀錄，請稍後再試。';
        console.error('載入歷史紀錄失敗：', e);
      }
    }

    loadHistory();

function generateRandomNumbers() {
  const nums = new Set();
  while (nums.size < 6) {
    nums.add(Math.floor(Math.random() * 49) + 1);
  }
  const arr = Array.from(nums);
  for (let i = 0; i < 6; i++) {
    document.getElementById("num" + (i + 1)).value = arr[i];
  }
  document.getElementById("result").textContent = "";
}


function copyWinningNumbers() {
  const numbers = Array.from(document.querySelectorAll(".number:not(.special)"))
                      .map(el => el.textContent.trim());
  for (let i = 0; i < 6; i++) {
    document.getElementById("num" + (i + 1)).value = numbers[i] || '';
  }
  document.getElementById("result").textContent = "";
}


async function loadLatestDraw() {
  try {
    const res = await fetch('https://superiorapis.cteam.com.tw/api/lottery/649/latest');
    const data = await res.json();
    const table = `
      <table style="margin: 0 auto; border-collapse: collapse;">
        <tr>
          <th style="padding:4px;">期別</th>
          <th style="padding:4px;">開獎日期</th>
          <th style="padding:4px;">號碼</th>
          <th style="padding:4px;">特別號</th>
        </tr>
        <tr>
          <td style="padding:4px;">第${data.term}期</td>
          <td style="padding:4px;">${data.date}</td>
          <td style="padding:4px;">${data.numbers.map(n => String(n).padStart(2, '0')).join(', ')}</td>
          <td style="padding:4px; color: red; font-weight:bold;">${data.special}</td>
        </tr>
      </table>
    `;
    document.getElementById('latestTable').innerHTML = table;
  } catch (e) {
    document.getElementById('latestTable').textContent = '無法載入開獎資料，請稍後再試。';
    console.error('載入失敗', e);
  }
}
loadLatestDraw();


document.querySelectorAll('input[id^="num"]').forEach(input => {
  input.addEventListener("focus", function () {
    document.getElementById("result").textContent = "";
    document.getElementById("lottoNumbers").innerHTML = "";
  });
});


document.querySelectorAll('input[id^="num"]').forEach((input, index) => {
  input.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      checkWinning();
    }
  });
});

  </script>
</body>
</html>
